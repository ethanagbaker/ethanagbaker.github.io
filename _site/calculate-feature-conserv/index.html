<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Calculating Mean Conservation Score on Genomic Features &#8211; Ethan Alexander Garc&iacutea Baker</title>
<meta name="description" content="Calculating feature conservation from the UCSC conservation track with Pandas">
<meta name="keywords" content="code">



<!-- Twitter Cards -->
<meta name="twitter:title" content="Calculating Mean Conservation Score on Genomic Features">
<meta name="twitter:description" content="Calculating feature conservation from the UCSC conservation track with Pandas">
<meta name="twitter:site" content="@ethanagbaker">
<meta name="twitter:creator" content="@ethanagbaker">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="/images/default-thumb.png">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Calculating Mean Conservation Score on Genomic Features">
<meta property="og:description" content="Calculating feature conservation from the UCSC conservation track with Pandas">
<meta property="og:url" content="/calculate-feature-conserv/">
<meta property="og:site_name" content="Ethan Alexander Garc&iacutea Baker">

<meta property="og:image" content="/images/default-thumb.png">






<link rel="canonical" href="/calculate-feature-conserv/">
<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Ethan Alexander Garc&iacutea Baker Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
	<script src="/assets/js/vendor/html5shiv.min.js"></script>
	<script src="/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>

<link href='//fonts.googleapis.com/css?family=PT+Sans+Narrow:400,700%7CPT+Serif:400,700,400italic' rel='stylesheet' type='text/css'>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body class="post">

<!--[if lt IE 9]><div class="browser-upgrade alert alert-info">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</div><![endif]-->

<div class="navigation-wrapper">
	<div class="site-name">
		<a href="/">Ethan Alexander Garc&iacutea Baker</a>
	</div><!-- /.site-name -->
	<div class="top-navigation">
		<nav role="navigation" id="site-nav" class="nav">
		    <ul>
		        
				    
				        
				    
				    <li><a href="/hello/" >Hello.</a></li>
				
				    
				        
				    
				    <li><a href="/research/" >Research.</a></li>
				
				    
				        
				    
				    <li><a href="/journal/" >Journal.</a></li>
				
		    </ul>
		</nav>
	</div><!-- /.top-navigation -->
</div><!-- /.navigation-wrapper -->



<div id="main" role="main">
  <div class="article-author-side">
    


<div itemscope itemtype="http://schema.org/Person">


	<img src="/images/avatar2.jpg" class="bio-photo" alt="Ethan Alexander Garc&iacutea Baker bio photo">


  <h3 itemprop="name">Ethan Alexander Garc&iacutea Baker</h3>
  <p>student/scientist/ philosopher/ bioinformatician/ adventurer/TBD. In training. 
 B.Phil. Candidate, University of Pittsburgh.</p>
  <a href="mailto:ethanagbaker+website@gmail.com" class="author-social" target="_blank"><i class="fa fa-fw fa-envelope-square"></i> Email</a>
  <a href="http://twitter.com/ethanagbaker" class="author-social" target="_blank"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a>
  <a href="http://facebook.com/ethanabaker" class="author-social" target="_blank"><i class="fa fa-fw fa-facebook-square"></i> Facebook</a>
  
  <a href="http://linkedin.com/in/ethanagbaker" class="author-social" target="_blank"><i class="fa fa-fw fa-linkedin-square"></i> LinkedIn</a>
  
  
  
  <a href="http://github.com/ethanagbaker" class="author-social" target="_blank"><i class="fa fa-fw fa-github"></i> Github</a>
  
  
  
  
  
  
  
  
  
  
  
</div>

  </div>
  <article class="post">
    <div class="headline-wrap">
      
        <h1><a href="/calculate-feature-conserv/" rel="bookmark" title="Calculating Mean Conservation Score on Genomic Features">Calculating Mean Conservation Score on Genomic Features</a></h1>
      
    </div><!--/ .headline-wrap -->
    <div class="article-wrap">
      <hr />

<p>This code will calculate the mean conservation score on the features in a BED file from the USCS Genome Browser.
<br />
<br />
It requires Python and Pandas (<code>pip install pandas</code>).
<br />
<br />
This also requires that your feature file be a BED-like format - chromosome, start, end, and name positions must follow the BED specification, but additional columns can be appended and preserved. Data from the UCSC Conservation Track (downloaded as single base conservation) should also be converted to one BED-like file per chromosome, which can be done trivially by using the <code>cat -n</code> command in Terminal, adding the chromosome name (in the same style as the feature file) to each line with <code>awk</code>, and ensuring that all whitespace characteres are tabs (<code>/t</code>).
<br />
<br />
A sample <code>featureFile</code> and <code>conservationFile</code> might look something like this:</p>

<script src="https://gist.github.com/dc7bc62a413cbbc32bbf944125845afd.js"> </script>

<p>Now, the code:</p>

<pre><code>from __future__ import division
import pandas as pd

FEATUREFILE = 'filename'
CONSERVATIONFILEDIR = './conservation/'

peakDF = pd.read_csv(str(FEATUREFILE), sep = '\t', header=None, names=['chrom','start','end','name','enrichmentVal'])
#Reject negative peak starts, if they exist (sometimes this can happen w/ MACS)
peakDF.drop(peakDF[peakDF.start &lt;= 0].index, inplace=True)
peakDF.reset_index(inplace=True)
peakDF.drop('index', axis=1, inplace=True)
peakDF['conservation'] = 1.0

chromNames = peakDF.chrom.unique()

for chromosome in chromNames: 
    chromSubset = peakDF[peakDF.chrom == str(chromosome)]
    chromDF = pd.read_csv(str(CONSERVATIONFILEDIR) + str(chromosome)+'.bed', sep='\t', header=None, names=['chrom','start','end','conserveScore'])

    for i in xrange(0,len(chromSubset.index)):
	    x = chromDF[chromDF.start &gt;= chromSubset['start'][chromSubset.index[i]]]
	    featureSubset = x[x.start &lt; chromSubset['end'][chromSubset.index[i]]]
	    x=None
	    featureConservation = float(sum(featureSubset.conserveScore)/(chromSubset['end'][chromSubset.index[i]]-chromSubset['start'][chromSubset.index[i]]))
	    peakDF.set_value(chromSubset.index[i],'conservation',featureConservation)
	    featureSubset=None
peakDF.to_csv("featureConservation.td", sep = '\t')
</code></pre>

<p>This will write a tab-delimited, BED-like file of calculated mean conservation values on each feature in <code>featureFile</code>. It might look something like this:</p>

<script src="https://gist.github.com/1749196f79a23687fe4fa6c6f025c0e8.js"> </script>


      <hr />
      <footer role="contentinfo">
        <div class="social-share">
  <h4>Share on</h4>
  <ul>
    <li>
      <a href="https://twitter.com/intent/tweet?text=/calculate-feature-conserv/" class="twitter" title="Share on Twitter"><i class="fa fa-twitter"></i><span> Twitter</span></a>
    </li>
    <li>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/calculate-feature-conserv/" class="facebook" title="Share on Facebook"><i class="fa fa-facebook"></i><span> Facebook</span></a>
    </li>
    <li>
      <a href="https://plus.google.com/share?url=/calculate-feature-conserv/" class="google-plus" title="Share on Google Plus"><i class="fa fa-google-plus"></i><span> Google+</span></a>
    </li>
  </ul>
</div><!-- /.social-share -->
        <p class="byline"><strong>Calculating Mean Conservation Score on Genomic Features</strong> was published on <time datetime="2016-06-27T00:00:00-04:00">June 27, 2016</time>.</p>
      </footer>
    </div><!-- /.article-wrap -->
  
    <section id="disqus_thread"></section><!-- /#disqus_thread -->
  
  </article>
</div><!-- /#main -->

<div class="footer-wrap">
  
  <div class="related-articles">
  <h4>You might also enjoy <small class="pull-right">(<a href="/journal/">View all posts</a>)</small></h4>
    <ul>
    
      <li><a href="/silico-preprint-available/" title="SiLiCO: A Simulator of Long Read Sequencing in PacBio and Oxford Nanopore">SiLiCO: A Simulator of Long Read Sequencing in PacBio and Oxford Nanopore</a></li>
    
      <li><a href="/goldwater-results/" title="Barry M. Goldwater Scholarship Honorable Mention">Barry M. Goldwater Scholarship Honorable Mention</a></li>
    
      <li><a href="/goldwater-nominee/" title="Barry M. Goldwater Scholarship Nomination">Barry M. Goldwater Scholarship Nomination</a></li>
    
    </ul>
    <hr />
  </div><!-- /.related-articles -->
  
  <footer>
    

<span>&copy; 2016 Ethan Alexander Garc&iacutea Baker. 

  </footer>
</div><!-- /.footer-wrap -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="/assets/js/scripts.min.js"></script>


  
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'ethanagbaker'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>





</body>
</html>
